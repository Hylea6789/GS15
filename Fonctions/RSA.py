import random
from Fonctions.Fonctions import inverse, exponentiation_rapide, pgcd




def parametre_rsa() -> (int, int, int):
    """
    Calcul des clés pour rsa
    On génère d'abord p et q premiers qui permettent de déterminer la premier clé n
    Puis on calcul phi et e premier à phi
    n et e sont les clés publiques
    On calcule alors d inverse de e mod phi
    d est la clé secrète
    e, p et q sont déjà renseignés pour réduire le temps de calcul de l'algorithme
    """
    p: int = 120877918482540368743824706748115473639820104245486721086655514775674663101382471591933941218764611662154561102143981501112226323077389982467906837735641384870195766777388872176992003111937256114221632839502641245520456389357038874824302292301025729098051849491021167786247259529421846351170444553506026737079
    q: int = 156846740033582598360587784105027657768402411009914113187252891608877283849836891932291370500271520218415766897310352692636387130651237364114946004715508141566339590153478339709742590300188182777141857939575330245801964240155137313958012035559233959486055480063879048541977389168391692508230790638580090576607
    n = p * q
    phi = (p - 1) * (q - 1)
    e = 4545378046932169293228348371052354355345019972741204369297627668658470246054411093092754526252595058740652670751712199362961919188974746863130518448187226321158944384316795105680709693466906331022049670399909337395474723820822490967223579076373729546515386536903421930503491849014790602996908090443478222918250976122408005146723184437319974429141006513275186432084952506951291333410165027180191952183484167269679390119532166345573939531118283967175723443254641924070854203993294722196633436218086846286568847403217454560396300140447974196876437691198252209431751670826409115116698411392986477109526708973488070054979

    d = inverse(e, phi)
    return n, e, d


def signature_rsa(m: int):
    n, e, d = parametre_rsa()
    sig_m: int = exponentiation_rapide(m, d, n)  # signature d'une clé/message
    return sig_m, e, n


def verification_rsa(sig_m: int, m: int, e: int, n: int):
    verif_m: int = exponentiation_rapide(sig_m, e, n)  # verification de la signature

    return verif_m == m


